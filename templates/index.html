<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invisible Cloak - Web App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 900px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 1.2em;
        }

        .mode-selector {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #2196f3;
        }

        .mode-selector h3 {
            color: #1565c0;
            margin-bottom: 15px;
        }

        .mode-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .video-container {
            background: linear-gradient(135deg, #000 0%, #333 100%);
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            position: relative;
            min-height: 400px;
        }

        #videoFeed {
            width: 100%;
            height: auto;
            display: block;
        }

        #placeholder {
            background: linear-gradient(135deg, #333 0%, #555 100%);
            color: white;
            padding: 100px 20px;
            text-align: center;
            font-size: 1.2em;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #48cae4 0%, #023e8a 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
        }

        .status {
            margin: 15px 0;
            padding: 15px 20px;
            border-radius: 10px;
            font-weight: bold;
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status.success {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 2px solid #28a745;
        }

        .status.error {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .status.info {
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
            color: #0c5460;
            border: 2px solid #17a2b8;
        }

        .info-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #ffc107;
            text-align: left;
        }

        .info-box h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #856404;
            margin: 5px 0;
        }

        .instructions {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: left;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .instructions h3 {
            color: #495057;
            margin-bottom: 15px;
            text-align: center;
        }

        .instructions ol {
            color: #6c757d;
            padding-left: 25px;
        }

        .instructions li {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .instructions strong {
            color: #495057;
        }

        .cloak-status {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid #4caf50;
        }

        .cloak-status h3 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .status-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .status-item label {
            color: #666;
            font-size: 0.9em;
            display: block;
            margin-bottom: 5px;
        }

        .status-item value {
            color: #333;
            font-size: 1.2em;
            font-weight: bold;
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }

            .mode-buttons {
                flex-direction: column;
                align-items: center;
            }

            .status-grid {
                grid-template-columns: 1fr;
            }
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }

        .badge-active {
            background: #28a745;
            color: white;
        }

        .badge-inactive {
            background: #6c757d;
            color: white;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü™Ñ Invisible Cloak</h1>
        <p class="subtitle">Experience the magic of computer vision with OpenCV!</p>

        <div class="mode-selector">
            <h3>üìπ Select Camera Mode</h3>
            <p style="color: #666; margin-bottom: 15px;">Choose how you want to access the camera</p>
            <div class="mode-buttons">
                <button class="btn btn-success" onclick="setMode('server')">
                    üñ•Ô∏è Server Camera (Local Only)
                </button>
                <button class="btn btn-info" onclick="setMode('client')">
                    üåê Client Camera (Web Compatible)
                </button>
            </div>
            <p id="currentMode" style="margin-top: 15px; color: #1565c0; font-weight: bold;">
                Current Mode: <span id="modeText">Not Selected</span>
            </p>
        </div>

        <div class="info-box">
            <h3>üí° Quick Guide</h3>
            <p id="modeInfo">Please select a camera mode above to get started.</p>
        </div>

        <div class="video-container">
            <img id="videoFeed" src="" alt="Video Feed" style="display: none;" />
            <div id="placeholder">
                <h3>üé¨ Camera Preview</h3>
                <p>Select a mode and start the camera to see the magic!</p>
            </div>
        </div>

        <div class="cloak-status">
            <h3>üîç Cloak Processing Status</h3>
            <div class="status-grid">
                <div class="status-item">
                    <label>Camera Status</label>
                    <value id="cameraStatus">Inactive</value>
                </div>
                <div class="status-item">
                    <label>Background</label>
                    <value id="backgroundStatus">Not Captured</value>
                </div>
                <div class="status-item">
                    <label>Frames Processed</label>
                    <value id="framesProcessed">0</value>
                </div>
                <div class="status-item">
                    <label>Effect Status</label>
                    <value id="effectStatus">Inactive</value>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="startCamera()" id="startBtn">
                üé• Start Camera
            </button>
            <button class="btn btn-danger" onclick="stopCamera()" id="stopBtn">
                ‚èπÔ∏è Stop Camera
            </button>
            <button class="btn btn-warning" onclick="captureBackground()" id="bgBtn">
                üì∑ Capture Background
            </button>
            <button class="btn btn-info" onclick="resetSmoothing()" id="resetBtn">
                üîÑ Reset Smoothing
            </button>
            <button class="btn" onclick="checkStatus()" id="statusBtn">
                üìä Check Status
            </button>
            <button class="btn btn-info" onclick="debugCamera()">
                üîç Debug Camera
            </button>
        </div>

        <div id="status" class="status"></div>

        <div class="instructions">
            <h3>üìã How to Use the Invisible Cloak</h3>
            <ol>
                <li><strong>Select Camera Mode:</strong>
                    <ul style="margin-top: 5px;">
                        <li><strong>Server Camera:</strong> Works only on local machine (localhost). Uses OpenCV directly.</li>
                        <li><strong>Client Camera:</strong> Works on deployed websites. Uses browser camera access.</li>
                    </ul>
                </li>
                <li><strong>Start Camera:</strong> Click "Start Camera" to initialize the video feed</li>
                <li><strong>Capture Background:</strong> 
                    <ul style="margin-top: 5px;">
                        <li>Make sure you are NOT in the frame</li>
                        <li>Keep the background stable and well-lit</li>
                        <li>Click "Capture Background" and wait 3 seconds</li>
                    </ul>
                </li>
                <li><strong>Get a Red Cloth:</strong> Use a bright red colored cloth, shirt, or any red object</li>
                <li><strong>Become Invisible:</strong> 
                    <ul style="margin-top: 5px;">
                        <li>Hold the red cloth in front of your body</li>
                        <li>The red areas will become invisible, showing the background</li>
                        <li>Move around to see the magic in action!</li>
                    </ul>
                </li>
                <li><strong>Tips for Best Results:</strong>
                    <ul style="margin-top: 5px;">
                        <li>Use good lighting conditions</li>
                        <li>Use solid red color (avoid patterns or mixed colors)</li>
                        <li>Keep the camera and background stable</li>
                        <li>Avoid wearing red clothes if you don't want to disappear!</li>
                    </ul>
                </li>
            </ol>
        </div>
    </div>

    <script>
        let currentMode = null;
        let updateInterval = null;

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }

        function setMode(mode) {
            currentMode = mode;
            const modeText = document.getElementById('modeText');
            const modeInfo = document.getElementById('modeInfo');
            
            if (mode === 'server') {
                modeText.textContent = 'Server Camera Mode (Local Only)';
                modeText.className = 'badge badge-active';
                modeInfo.innerHTML = '<strong>Server Mode Selected:</strong> This mode uses OpenCV on the server. It only works when running locally (localhost). All invisible cloak processing happens on the server with full OpenCV features.';
                showStatus('Server Camera Mode selected. Only works on localhost!', 'info');
            } else {
                modeText.textContent = 'Client Camera Mode (Web Compatible)';
                modeText.className = 'badge badge-active';
                modeInfo.innerHTML = '<strong>Client Mode Selected:</strong> This mode uses your browser camera. It works on deployed websites but has limited invisible cloak features. Processing happens in your browser using JavaScript.';
                showStatus('Client Camera Mode selected. Works on any website!', 'info');
            }
        }

        function startCamera() {
            if (!currentMode) {
                showStatus('Please select a camera mode first!', 'error');
                return;
            }

            if (currentMode === 'server') {
                // Server-side camera with OpenCV
                fetch('/start_camera')
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            document.getElementById('videoFeed').src = '/video_feed';
                            document.getElementById('videoFeed').style.display = 'block';
                            document.getElementById('placeholder').style.display = 'none';
                            showStatus(data.message, 'success');
                            startStatusUpdates();
                        } else {
                            showStatus(data.message, 'error');
                        }
                    })
                    .catch(error => {
                        showStatus('Error starting camera. Make sure you are running locally!', 'error');
                        console.error('Error:', error);
                    });
            } else {
                // Client-side camera (placeholder - would need full JavaScript implementation)
                showStatus('Client camera mode requires JavaScript camera access. This is a server-focused demo.', 'info');
            }
        }

        function stopCamera() {
            fetch('/stop_camera')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('videoFeed').src = '';
                    document.getElementById('videoFeed').style.display = 'none';
                    document.getElementById('placeholder').style.display = 'block';
                    showStatus(data.message, 'success');
                    stopStatusUpdates();
                    resetStatusDisplay();
                })
                .catch(error => {
                    showStatus('Error stopping camera', 'error');
                    console.error('Error:', error);
                });
        }

        function captureBackground() {
            showStatus('Please step out of the frame! Capturing background in 3 seconds...', 'info');
            
            setTimeout(() => {
                fetch('/capture_background')
                    .then(response => response.json())
                    .then(data => {
                        showStatus(data.message, data.status === 'success' ? 'success' : 'error');
                        if (data.status === 'success') {
                            checkStatus();
                        }
                    })
                    .catch(error => {
                        showStatus('Error capturing background', 'error');
                        console.error('Error:', error);
                    });
            }, 3000);
        }

        function resetSmoothing() {
            fetch('/reset_smoothing')
                .then(response => response.json())
                .then(data => {
                    showStatus(data.message, 'success');
                })
                .catch(error => {
                    showStatus('Error resetting smoothing', 'error');
                    console.error('Error:', error);
                });
        }

        function checkStatus() {
            fetch('/cloak_status')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('cameraStatus').textContent = data.camera_active ? 'Active ‚úì' : 'Inactive ‚úó';
                    document.getElementById('cameraStatus').style.color = data.camera_active ? '#28a745' : '#dc3545';
                    
                    document.getElementById('backgroundStatus').textContent = data.background_captured ? 'Captured ‚úì' : 'Not Captured ‚úó';
                    document.getElementById('backgroundStatus').style.color = data.background_captured ? '#28a745' : '#dc3545';
                    
                    document.getElementById('framesProcessed').textContent = data.frames_processed;
                    
                    const effectActive = data.camera_active && data.background_captured;
                    document.getElementById('effectStatus').textContent = effectActive ? 'Active ‚úì' : 'Inactive ‚úó';
                    document.getElementById('effectStatus').style.color = effectActive ? '#28a745' : '#dc3545';
                })
                .catch(error => {
                    console.error('Error checking status:', error);
                });
        }

        function debugCamera() {
            fetch('/debug_camera')
                .then(response => response.json())
                .then(data => {
                    const debugInfo = data.debug_info.join('\n');
                    alert('Camera Debug Information:\n\n' + debugInfo);
                })
                .catch(error => {
                    showStatus('Error getting debug info', 'error');
                    console.error('Error:', error);
                });
        }

        function startStatusUpdates() {
            updateInterval = setInterval(checkStatus, 2000); // Update every 2 seconds
        }

        function stopStatusUpdates() {
            if (updateInterval) {
                clearInterval(updateInterval);
                updateInterval = null;
            }
        }

        function resetStatusDisplay() {
            document.getElementById('cameraStatus').textContent = 'Inactive';
            document.getElementById('cameraStatus').style.color = '#333';
            document.getElementById('backgroundStatus').textContent = 'Not Captured';
            document.getElementById('backgroundStatus').style.color = '#333';
            document.getElementById('framesProcessed').textContent = '0';
            document.getElementById('effectStatus').textContent = 'Inactive';
            document.getElementById('effectStatus').style.color = '#333';
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('Welcome! Select a camera mode to get started.', 'info');
            resetStatusDisplay();
        });
    </script>
</body>
</html>
